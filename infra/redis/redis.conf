# redis.conf
# Redis configuration for DevCle
# Version: Redis 7.x

# ====================
# Network Configuration
# ====================

# Bind to all interfaces (Docker internal network)
bind 0.0.0.0

# Default Redis port
port 6379

# TCP backlog (default: 511)
tcp-backlog 511

# Close connection after client idle for N seconds (0 = disable)
timeout 0

# TCP keepalive (send ACKs to clients, default: 300)
tcp-keepalive 300

# ====================
# Security
# ====================

# Require password for authentication
# This will be overridden by REDIS_PASSWORD environment variable in docker-compose.yml
requirepass <REDIS_PASSWORD>

# Disable dangerous commands in production
rename-command FLUSHDB ""
rename-command FLUSHALL ""

# Note: CONFIG command is NOT disabled to allow diagnostic commands
# (INFO, CONFIG GET) for monitoring and validation
# In production, use ACL to restrict CONFIG SET while allowing CONFIG GET

# ====================
# Memory Management
# ====================

# Maximum memory limit (512MB for development, adjust for production)
maxmemory 512mb

# Eviction policy when maxmemory is reached
# allkeys-lru: Remove any key using LRU algorithm (good for cache)
# volatile-lru: Remove keys with expire set using LRU (good for sessions)
# We use allkeys-lru for general-purpose cache/session/queue
maxmemory-policy allkeys-lru

# LRU/LFU/minimal TTL samples (default: 5)
maxmemory-samples 5

# ====================
# Persistence (AOF)
# ====================

# Enable Append Only File for durability
appendonly yes

# AOF filename
appendfilename "appendonly.aof"

# AOF fsync policy
# always: fsync every write (slow, safest)
# everysec: fsync every second (good balance)
# no: let OS decide (fastest, least safe)
appendfsync everysec

# Rewrite AOF file when it grows by 100%
auto-aof-rewrite-percentage 100

# Minimum AOF file size before rewrite (64MB)
auto-aof-rewrite-min-size 64mb

# ====================
# Logging
# ====================

# Log level: debug, verbose, notice, warning
loglevel notice

# Log to stdout (Docker will capture)
logfile ""

# ====================
# Performance
# ====================

# Number of databases (default: 16)
databases 16

# Enable active memory defragmentation
activedefrag yes

# ====================
# Slow Log
# ====================

# Log queries slower than N microseconds (10ms = 10000)
slowlog-log-slower-than 10000

# Maximum slow log entries
slowlog-max-len 128
